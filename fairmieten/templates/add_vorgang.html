{% extends base %}
{% block content %}
<style type="text/tailwindcss">

@layer utilities {
	.vorgang_neu .inner-form p, .diskriminierungart-container .diskriminierungart-row{
	@apply flex 
  }	
  .vorgang_neu .inner-form label, .vorgang_neu .inner-form-diskrimminierung label{
	@apply basis-1/4 text-right mr-4  
  }	
  .vorgang_neu .inner-form-diskrimminierung .button-row{
	@apply basis-3/4    
  }
  .vorgang_neu .inner-form input, select, textarea{
    @apply basis-3/4 w-96 py-2 px-5 mb-4 font-semibold rounded shadow-md hover:bg-violet-100
  }
}
</style>  

<div class="with-sidebar vorgang_neu">
	<aside class="sidebar" id="sidebar">
      <ul >
		{% for item in form_liste %}
		<li>
			<a href="#form-{{ item.key }}"
				id="nav-{{ item.key }}">
				{{ item.label }}
			</a>
		</li>
	{% endfor %}
		  </ul>
    </aside>

    <div class="inner-content" id="htmx-inner-content" >
		{% for item in form_liste %}		
		<div id="form-{{ item.key }}" class="form-container" hx-get="{% url 'create_'|add:item.key %}?id={{form.instance.id}}&vorgang_id={{vorgang_id}}"
		hx-trigger="revealed once">
		<div class="form-placeholder">{{vorgang_id}}</div>
		</div>
		{% endfor %}
    </div>
  </div>


<script>
	function initializeObserver() {
		
		// Intersection Observer setup
		const formContainers = document.querySelectorAll('.form-container');
		const navLinks = document.querySelectorAll('.sidebar a');

		const observerOptions = {
			root: null,
			rootMargin: '0px',
			threshold: 0.5
		};

		const observer = new IntersectionObserver((entries) => {
			entries.forEach(entry => {
			if (entry.isIntersecting) {
				const formId = entry.target.id;
				const navId = 'nav-' + formId.split('-')[1];
				navLinks.forEach(link => link.classList.remove('active'));
				document.getElementById(navId).classList.add('active');
			}
			});
		}, observerOptions);

		formContainers.forEach(container => observer.observe(container));

		// Markiere den ersten Anker-Tag als aktiv
		if (navLinks.length > 0) {
			navLinks[0].classList.add('active');
		}
	}
	function handleInputChange(event) {
		const inputElement = event.target;
		inputElement.classList.add('edited'); // Fügen Sie die gewünschte Klasse hinzu
	}

	// Event Listener for htmx:afterSwap
	document.body.addEventListener('htmx:afterSwap', function() {
		initializeObserver();
		// Event Listener for input fields
		const inputFields = document.querySelectorAll('input, textarea, select');
		inputFields.forEach(input => {
			console.log("add Listener to " + input.id);
			input.addEventListener('input', handleInputChange);
		});
	});

</script>
{% endblock %}
